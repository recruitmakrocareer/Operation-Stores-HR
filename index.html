<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RecruitPro - Full Tracking System</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        input[type="date"]::-webkit-calendar-picker-indicator { cursor: pointer; opacity: 0.6; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const IconBase = ({ children, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>{children}</svg>
        );
        const Icons = {
            Users: (p) => <IconBase {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>,
            Plus: (p) => <IconBase {...p}><path d="M5 12h14"/><path d="M12 5v14"/></IconBase>,
            Search: (p) => <IconBase {...p}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>,
            Save: (p) => <IconBase {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>,
            X: (p) => <IconBase {...p}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>,
            Edit: (p) => <IconBase {...p}><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></IconBase>
        };

        const firebaseConfig = {
            apiKey: "AIzaSyB9REZdz72f_t0VbgRKS7zsyMJTb7bKigs",
            authDomain: "recruit-operation-project.firebaseapp.com",
            projectId: "recruit-operation-project",
            storageBucket: "recruit-operation-project.firebasestorage.app",
            messagingSenderId: "857023562077",
            appId: "1:857023562077:web:34ca0f38992c8f847e68b4"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);

        const App = () => {
            const [user, setUser] = React.useState(null);
            const [applicants, setApplicants] = React.useState([]);
            const [view, setView] = React.useState('list');
            const [searchTerm, setSearchTerm] = React.useState('');
            const [isSubmitting, setIsSubmitting] = React.useState(false);
            const [editingApplicant, setEditingApplicant] = React.useState(null);

            // ข้อมูลตัวเลือกตามหัวข้อคอลัมน์
            const STORES = ['1-Lardprao', '25-Suphan Buri', '46-Kanchanaburi', '49-Ratchaburi', '70-Sukhothai'];
            const CHANNELS = ['สมัครผ่านสาขา', 'Facebook', 'Line', 'TikTok', 'Walk-in'];
            const COMPANIES = ['ADC', 'Other'];
            const DEPARTMENTS = ['Picker', 'Driver', 'Admin', 'Other'];
            const POSITIONS = ['ADC - Picker', 'ADC - Driver', 'ADC - Admin'];
            const CRIMINAL_STATUS = ['ส่งตรวจแล้ว', 'ปกติ', 'มีประวัติ (พิจารณา)', 'รอดำเนินการ'];

            const [formData, setFormData] = React.useState({
                applyDate: new Date().toISOString().split('T')[0],
                name: '', phone: '', education: 'มัธยมศึกษา',
                store: STORES[0], area: 'Area 01',
                company: COMPANIES[0], department: DEPARTMENTS[0], position: POSITIONS[0],
                channel: CHANNELS[0], criminalCheck: CRIMINAL_STATUS[3],
                interviewDate: '', interviewStatus: 'อยู่ระหว่างนัดสัมภาษณ์',
                onboardDate: '', startStatus: 'รอเริ่มงาน', remark: ''
            });

            React.useEffect(() => {
                firebase.auth().signInAnonymously();
                firebase.auth().onAuthStateChanged(setUser);
                
                const unsubscribe = firebase.firestore().collection('recruitment_data')
                    .orderBy('createdAt', 'desc')
                    .onSnapshot(snap => {
                        setApplicants(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    });
                return () => unsubscribe();
            }, []);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setIsSubmitting(true);
                try {
                    await firebase.firestore().collection('recruitment_data').add({
                        ...formData,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    setView('list');
                    setFormData({...formData, name: '', phone: '', remark: ''});
                } catch (err) { alert(err.message); }
                setIsSubmitting(false);
            };

            const handleUpdate = async () => {
                setIsSubmitting(true);
                try {
                    await firebase.firestore().collection('recruitment_data').doc(editingApplicant.id).update(editingApplicant);
                    setEditingApplicant(null);
                } catch (err) { alert(err.message); }
                setIsSubmitting(false);
            };

            return (
                <div className="min-h-screen pb-20">
                    <nav className="bg-indigo-700 text-white p-5 flex justify-between items-center sticky top-0 z-50 shadow-lg">
                        <div className="flex items-center gap-3">
                            <Icons.Users className="w-7 h-7" />
                            <h1 className="text-xl font-bold tracking-tight">RecruitPro Tracking</h1>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setView('list')} className={`px-4 py-2 rounded-lg font-bold text-sm ${view === 'list' ? 'bg-white text-indigo-700' : 'hover:bg-indigo-600'}`}>รายการ</button>
                            <button onClick={() => setView('add')} className={`px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 ${view === 'add' ? 'bg-white text-indigo-700' : 'bg-indigo-500 hover:bg-indigo-400'}`}>
                                <Icons.Plus className="w-4 h-4" /> เพิ่มข้อมูล
                            </button>
                        </div>
                    </nav>

                    <main className="p-4 md:p-8 max-w-6xl mx-auto">
                        {view === 'add' ? (
                            <div className="bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden animate-in slide-in-from-bottom-4 duration-300">
                                <div className="bg-slate-800 p-6 text-white text-center">
                                    <h2 className="text-xl font-bold">บันทึกข้อมูลผู้สมัคร (ตามหัวข้อ CSV)</h2>
                                </div>
                                <form onSubmit={handleSubmit} className="p-8 space-y-8">
                                    {/* Section 1: Personal */}
                                    <div className="space-y-4">
                                        <h3 className="text-indigo-600 font-black text-xs uppercase tracking-widest border-b pb-2">1. ข้อมูลการสมัครและส่วนตัว</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                            <div><label className="text-xs font-bold text-slate-400">วันที่สมัคร</label>
                                            <input type="date" required name="applyDate" value={formData.applyDate} onChange={e => setFormData({...formData, applyDate: e.target.value})} className="w-full border rounded-xl p-3 text-sm mt-1 bg-slate-50" /></div>
                                            <div><label className="text-xs font-bold text-slate-400">ชื่อ-นามสกุล</label>
                                            <input required placeholder="ระบุชื่อจริง" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} className="w-full border rounded-xl p-3 text-sm mt-1 focus:ring-2 ring-indigo-500/20" /></div>
                                            <div><label className="text-xs font-bold text-slate-400">เบอร์โทรศัพท์</label>
                                            <input required placeholder="08x-xxxxxxx" value={formData.phone} onChange={e => setFormData({...formData, phone: e.target.value})} className="w-full border rounded-xl p-3 text-sm mt-1 bg-slate-50" /></div>
                                        </div>
                                    </div>

                                    {/* Section 2: Work Info */}
                                    <div className="space-y-4">
                                        <h3 className="text-indigo-600 font-black text-xs uppercase tracking-widest border-b pb-2">2. ข้อมูลสังกัดและตำแหน่ง</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                            <div><label className="text-xs font-bold text-slate-400">สาขา</label>
                                            <select value={formData.store} onChange={e => setFormData({...formData, store: e.target.value})} className="w-full border rounded-xl p-3 text-sm mt-1 bg-slate-50">
                                                {STORES.map(s => <option key={s} value={s}>{s}</option>)}
                                            </select></div>
                                            <div><label className="text-xs font-bold text-slate-400">บริษัท (Company)</label>
                                            <select value={formData.company} onChange={e => setFormData({...formData, company: e.target.value})} className="w-full border rounded-xl p-3 text-sm mt-1 bg-slate-50">
                                                {COMPANIES.map(c => <option key={c} value={c}>{c}</option>)}
                                            </select></div>
                                            <div><label className="text-xs font-bold text-slate-400">ตำแหน่ง</label>
                                            <select value={formData.position} onChange={e => setFormData({...formData, position: e.target.value})} className="w-full border rounded-xl p-3 text-sm mt-1 bg-slate-50">
                                                {POSITIONS.map(p => <option key={p} value={p}>{p}</option>)}
                                            </select></div>
                                        </div>
                                    </div>

                                    {/* Section 3: Status & Tracking */}
                                    <div className="space-y-4">
                                        <h3 className="text-indigo-600 font-black text-xs uppercase tracking-widest border-b pb-2">3. การติดตามผลและประวัติ</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                            <div><label className="text-xs font-bold text-slate-400">ช่องทางการสมัคร</label>
                                            <select value={formData.channel} onChange={e => setFormData({...formData, channel: e.target.value})} className="w-full border rounded-xl p-3 text-sm mt-1 bg-slate-50">
                                                {CHANNELS.map(c => <option key={c} value={c}>{c}</option>)}
                                            </select></div>
                                            <div><label className="text-xs font-bold text-slate-400">สถานะตรวจประวัติอาชญากรรม</label>
                                            <select value={formData.criminalCheck} onChange={e => setFormData({...formData, criminalCheck: e.target.value})} className="w-full border rounded-xl p-3 text-sm mt-1 bg-slate-50">
                                                {CRIMINAL_STATUS.map(s => <option key={s} value={s}>{s}</option>)}
                                            </select></div>
                                            <div><label className="text-xs font-bold text-slate-400">วุฒิการศึกษา</label>
                                            <input value={formData.education} onChange={e => setFormData({...formData, education: e.target.value})} className="w-full border rounded-xl p-3 text-sm mt-1 bg-slate-50" /></div>
                                        </div>
                                    </div>

                                    <div className="bg-slate-50 p-6 rounded-2xl space-y-2">
                                        <label className="text-xs font-bold text-slate-400">หมายเหตุเพิ่มเติม</label>
                                        <textarea value={formData.remark} onChange={e => setFormData({...formData, remark: e.target.value})} className="w-full border rounded-xl p-4 text-sm outline-none focus:ring-2 ring-indigo-500/20" rows="3" placeholder="ระบุรายละเอียดอื่นๆ เช่น ประสบการณ์ทำงาน..."></textarea>
                                    </div>

                                    <div className="flex gap-4">
                                        <button type="button" onClick={() => setView('list')} className="flex-1 py-4 font-bold text-slate-400 hover:bg-slate-50 rounded-2xl transition">ยกเลิก</button>
                                        <button type="submit" disabled={isSubmitting} className="flex-[2] py-4 bg-indigo-600 text-white rounded-2xl font-bold shadow-xl shadow-indigo-100 hover:bg-indigo-700 transition flex items-center justify-center gap-2">
                                            <Icons.Save className="w-5 h-5" /> {isSubmitting ? 'กำลังบันทึก...' : 'บันทึกข้อมูลเข้าฐานข้อมูล'}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        ) : (
                            <div className="space-y-6">
                                <div className="relative group">
                                    <Icons.Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-300 w-5 h-5 group-focus-within:text-indigo-600 transition" />
                                    <input type="text" placeholder="ค้นหาชื่อผู้สมัคร หรือ สาขา..." className="w-full pl-12 pr-6 py-4 bg-white border border-slate-200 rounded-[1.5rem] shadow-sm focus:ring-4 focus:ring-indigo-500/10 outline-none transition" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} />
                                </div>

                                <div className="bg-white rounded-[2rem] border border-slate-200 shadow-sm overflow-hidden">
                                    <table className="w-full text-left">
                                        <thead className="bg-slate-50 text-slate-400 text-[10px] font-black uppercase tracking-widest border-b">
                                            <tr>
                                                <th className="px-8 py-5">รายชื่อ / ติดต่อ</th>
                                                <th className="px-8 py-5">ตำแหน่ง / บริษัท</th>
                                                <th className="px-8 py-5">สถานะสัมภาษณ์</th>
                                                <th className="px-8 py-5">สถานะเริ่มงาน</th>
                                                <th className="px-8 py-5 text-right">#</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-50">
                                            {applicants.filter(a => a.name?.includes(searchTerm)).map(app => (
                                                <tr key={app.id} className="hover:bg-slate-50 transition">
                                                    <td className="px-8 py-5">
                                                        <div className="font-bold text-slate-800">{app.name}</div>
                                                        <div className="text-xs text-indigo-500 font-bold">{app.phone}</div>
                                                    </td>
                                                    <td className="px-8 py-5 text-sm font-semibold text-slate-600">
                                                        {app.position}
                                                        <div className="text-[10px] text-slate-400 font-bold uppercase">{app.company}</div>
                                                    </td>
                                                    <td className="px-8 py-5">
                                                        <span className={`px-3 py-1 rounded-full text-[10px] font-bold border ${app.interviewStatus === 'ผ่านสัมภาษณ์' ? 'bg-emerald-50 text-emerald-600 border-emerald-100' : 'bg-amber-50 text-amber-600 border-amber-100'}`}>
                                                            {app.interviewStatus}
                                                        </span>
                                                    </td>
                                                    <td className="px-8 py-5">
                                                        <span className="text-xs font-bold text-slate-500">{app.startStatus}</span>
                                                    </td>
                                                    <td className="px-8 py-5 text-right">
                                                        <button onClick={() => setEditingApplicant(app)} className="p-3 text-slate-300 hover:text-indigo-600 hover:bg-indigo-50 rounded-2xl transition">
                                                            <Icons.Edit className="w-5 h-5" />
                                                        </button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Edit Modal สำหรับแก้ไขสถานะ (เพิ่มช่อง วันที่สัมภาษณ์ และ วันเริ่มงาน) */}
                    {editingApplicant && (
                        <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-[2.5rem] w-full max-w-md p-8 shadow-2xl animate-in zoom-in-95 duration-200">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="font-black text-xl text-slate-800">อัปเดตสถานะงาน</h3>
                                    <button onClick={() => setEditingApplicant(null)} className="text-slate-400"><Icons.X /></button>
                                </div>
                                <div className="space-y-4">
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="text-[10px] font-bold text-indigo-600 uppercase">วันที่สัมภาษณ์</label>
                                        <input type="date" value={editingApplicant.interviewDate} onChange={e => setEditingApplicant({...editingApplicant, interviewDate: e.target.value})} className="w-full border rounded-xl p-3 text-sm mt-1 bg-slate-50" /></div>
                                        <div><label className="text-[10px] font-bold text-indigo-600 uppercase">สถานะสัมภาษณ์</label>
                                        <select value={editingApplicant.interviewStatus} onChange={e => setEditingApplicant({...editingApplicant, interviewStatus: e.target.value})} className="w-full border rounded-xl p-3 text-sm mt-1 bg-slate-50 font-bold">
                                            {STATUS_OPTIONS.map(o => <option key={o} value={o}>{o}</option>)}
                                        </select></div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="text-[10px] font-bold text-indigo-600 uppercase">วันที่เริ่มงาน</label>
                                        <input type="date" value={editingApplicant.onboardDate} onChange={e => setEditingApplicant({...editingApplicant, onboardDate: e.target.value})} className="w-full border rounded-xl p-3 text-sm mt-1 bg-slate-50" /></div>
                                        <div><label className="text-[10px] font-bold text-indigo-600 uppercase">สถานะเริ่มงาน</label>
                                        <select value={editingApplicant.startStatus} onChange={e => setEditingApplicant({...editingApplicant, startStatus: e.target.value})} className="w-full border rounded-xl p-3 text-sm mt-1 bg-slate-50 font-bold">
                                            {START_STATUS_OPTIONS.map(o => <option key={o} value={o}>{o}</option>)}
                                        </select></div>
                                    </div>
                                    <button onClick={handleUpdate} disabled={isSubmitting} className="w-full py-4 bg-indigo-600 text-white rounded-2xl font-black shadow-xl hover:bg-indigo-700 transition flex items-center justify-center gap-3">
                                        <Icons.Save className="w-5 h-5" /> บันทึกการเปลี่ยนแปลง
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
